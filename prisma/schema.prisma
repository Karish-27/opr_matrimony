// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
   id             Int      @id @default(autoincrement())
  email     String   @unique // ✅ From register form
  password  String // ✅ From register form  
  firstName String // ✅ From register form
  lastName  String // ✅ From register form
  isActive  Boolean  @default(true) // User status (active/inactive)
  credits   Int      @default(2) // Default 2 credits for new users
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relation to Profile
  profile     Profile?
  
  // Relation to ProfileViews (profiles this user has viewed)
  profileViews ProfileView[]
}

model Profile {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique
  firstName String
  lastName  String
  age       Int?
  regNo      String   @unique
  liked      Boolean? @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relation to User
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  userProfile UserProfile?
  parentInfo ParentInfo?
  horoscopeProfile HoroscopeProfile?
}

model UserProfile {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique
  type           String
  dietType       String
  dob            DateTime
  age            Int
  height         String
  color          String
  education      String
  career         String
  salary         String
  familyProperty String
  expectation    String
  phone          String
  caste          String
  marriageStatus String
  profilePhotos  Json
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  profile        Profile  @relation(fields: [userId], references: [userId], onDelete: Cascade)
}

model ParentInfo {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique
  fatherName       String
  motherName       String
  fatherNative     String
  motherNative     String
  fatherProfession String
  motherProfession String
  phone            String
  address          String
  brothers         Int
  elderBrothers    Int
  youngerBrothers  Int
  marriedBrothers  Int
  sisters          Int
  elderSisters     Int
  youngerSisters   Int
  marriedSisters   Int

  profile          Profile @relation(fields: [userId], references: [userId], onDelete: Cascade)
}

model HoroscopeProfile {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique
  zodiacSign         String
  tamilYear          String
  tamilMonth         String
  udayathiNatchat    String
  day                String
  birthTime          String
  starFoot           String
  ascendant          String
  birthplace         String
  natalDirection     String
  horoscopeDocuments Json?

  profile            Profile @relation(fields: [userId], references: [userId], onDelete: Cascade)
}

model ProfileView {
  id        Int      @id @default(autoincrement())
  userId    Int      // User who viewed the profile
  profileId Int      // Profile that was viewed (refers to Profile.userId)
  viewedAt  DateTime @default(now())
  
  // Relation to User
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Ensure a user can only view a specific profile once
  @@unique([userId, profileId])
}

model Payment {
  id              Int      @id @default(autoincrement())
  customerName    String
  transactionAmount Float
  transactionDate DateTime
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
